<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Meta Tags -->
  <meta charset="UTF-8">
  <meta name="author" content="grupo 52">
  <meta name="description" content="este es un inventario">
  <meta name="keywords" content="inventario, ss html, JavaScript">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Title -->
  <title>Inventario</title>
  <!-- Favicon -->
  <link rel="icon" href="img/favicon.ico">
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css"
    integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp" crossorigin="anonymous">
  <!-- W3 Stylesheet -->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <!-- Stylesheet -->
  <link rel="stylesheet" href="./csss/estiloshamburger.css">
</head>

<body>
  <!-- Navigation Bar -->
  <nav>
    <input title="check" type="checkbox" id="check">
    <label for="check" class="checkbtn">
      <i class="fas fa-bars"></i>
    </label>
    <div class="nav-mobile w3-animate-right">
      <a href="index2.html">About</a>
      <a onclick="renderizarInventario()">Inventario</a>
      <a onclick="renderizarCatalogo()">Catalogo</a>
    </div>
  </nav>
  <main>
    <iframe class="load" src="plantillas/about.html"></iframe>
  </main>
  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxBk8ZWUlTBKbXm9AqwQmL-aARY1jC2jbSnqNprF6UP9q46BY2dH5XkEKApxiSr81fQRQ/exec"; // Reemplaza con tu WebApp

    let catalogo = [];
    let inventario = [];

    // Cargar catálogo
    function cargarCatalogo() {
      fetch(API_URL + "?action=getCatalogo")
        .then(r => r.json())
        .then(data => {
          catalogo = data;
          const tbody = document.getElementById('tablaCatalogo');
          tbody.innerHTML = '';
          catalogo.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${item[0]}</td><td>${item[1]}</td>`;
            tbody.appendChild(tr);
          });
        });
    }

    // Cargar inventario
    function cargarInventario() {
      fetch(API_URL + "?action=getInventario")
        .then(r => r.json())
        .then(data => {
          inventario = data;
          const tbody = document.getElementById('tablaInventario');
          tbody.innerHTML = '';
          inventario.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
          <td>${item[0]}</td>
          <td>${item[1]}</td>
          <td>${item[2]}</td>
          <td>
            <button class="fa fa-pen" onclick="editarProducto('${item[0]}')"> Editar</button>
            <button class="fa fa-trash" onclick="eliminarProducto('${item[0]}')"> Eliminar</button>
          </td>`;
            tbody.appendChild(tr);
          });
        });
    }



    // Autocompletar descripción
    document.getElementById('codigo').addEventListener('blur', () => {
      const codigo = document.getElementById('codigo').value.trim();
      const item = catalogo.find(x => x[0] === codigo);
      if (item) document.getElementById('descripcion').value = item[1];
    });

    // Guardar producto
    document.getElementById('formProducto').addEventListener('submit', e => {
      e.preventDefault();
      const data = {
        action: "guardar",
        codigo: document.getElementById('codigo').value.trim(),
        descripcion: document.getElementById('descripcion').value.trim(),
        cantidad: document.getElementById('cantidad').value
      };
      fetch(API_URL, { method: "POST", body: JSON.stringify(data) })
        .then(r => r.json())
        .then(() => {
          alert("¡Producto guardado exitosamente!");
          document.getElementById('formProducto').reset();
          cargarInventario();
        })
        .catch(error => {
          console.error('Error al guardar:', error);
          alert("Hubo un error al guardar el producto.");
        });
    });

    // Editar producto
    function editarProducto(codigo) {
      const item = inventario.find(x => x[0] === codigo);
      if (item) {
        document.getElementById('codigo').value = item[0];
        document.getElementById('descripcion').value = item[1];
        document.getElementById('cantidad').value = item[2];
      }
    }

    // Eliminar producto
    function eliminarProducto(codigo) {
      if (confirm('¿Eliminar este producto?')) {
        const data = {
          action: "eliminar",
          codigo: codigo
        };
        fetch(API_URL, { method: "POST", body: JSON.stringify(data) })
          .then(r => r.json())
          .then(() => {
            alert("¡Producto eliminado exitosamente!");
            cargarInventario();
          })
          .catch(error => {
            console.error('Error al eliminar:', error);
            alert("Hubo un error al eliminar el producto.");
          });
      }
    }

    // Inicializar

    //renderizar catalogo

    function renderizarCatalogo() {
      const contenedor = document.querySelector('main');
      const iframe = document.querySelector('iframe');
      iframe.remove();
      contenedor.innerHTML += '<iframe class="load" src="plantillas/catalogo.html"></iframe>';
      setTimeout(() => {
        cargarCatalogo();
      }, 50);
    }

    function renderizarInventario() {
      const contenedor = document.querySelector('main');
      const iframe = document.querySelector('iframe');
      iframe.remove();
      contenedor.innerHTML += '<iframe class="load" src="plantillas/inventario.html"></iframe>';
      setTimeout(() => {
        cargarCatalogo();
      }, 50);
    }

  </script>
</body>

</html>